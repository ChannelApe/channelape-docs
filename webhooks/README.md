# Webhooks

## Overview

This document describes the webhooks available in ChannelApe and their usage.

## Receiving Webhooks

ChannelApe will send the webhook to the HTTPs endpoint provided by your application.

### Responding to Webhooks

Your endpoint should return a successful response code to acknowledge its receipt.

Status codes >= 200 and <= 399 are treated as a successful delivery and will not be retried.

#### Retry Policy

For all other response codes or a failure to respond in general, ChannelApe will retry webhooks[^1] every `15 minutes` until successful delivery or a user intervenes.

[^1]: ChannelApe will always include the most up-to-date copy of the object and as such, the contents of the payload may change between attempts.

### Authentication and Security

Although ChannelApe does not support authenticated endpoints, a key and secret can be configured for each endpoint.

The key will be included as a query parameter in the request and its secret for the value.

The secret is never displayed to end users.

## Webhooks

1. Stock Transfer Order
1. Ship Confirmation
1. Advanced Ship Notice
1. Receipt Confirmation

### Stock Transfer Order

ChannelApe's Order Management System sends this to the party responsible for fulfilling the Stock Transfer Order.

#### Timing

Stock Transfer Orders are evaluated in batches by ChannelApe's Order Management System every `15 minutes`.

#### Example Payload

```json
{
  "purchaseOrderNumber": "4600000039",
  "warehouseOrderId": "4600000039",
  "channelOrderId": "STO4600000039",
  "purchasedAt": "2023-04-01T00:00:00.000Z",
  "shippingCompany": "FEDEX",
  "shippingMethod": "GROUND",
  "locationId": "969",
  "warehouseCode": "COLUMBUS",
  "warehouseCompany": "Rothys",
  "warehouseName": "POS 181 Columbus",
  "warehouseId": "67740827810",
  "warehouseZipcode": "10023",
  "status": "OPEN",
  "additionalFields": {
    "ship_by_date": "2023-04-08T00:00:00.000Z",
    "deliver_by_date": "2023-04-08T00:00:00.000Z",
    "note_attributes_ship_from": "969",
    "note_attributes_ship_to": "819",
    "shipping_lines_title": "VENDOR",
    "sap_source_location": "1111",
    "sap_destination_location": "2222",
    "sap_source_storage_location": "1111",
    "sap_destination_storage_location": "2222",
    "note_attribute_retail_order": "true"
  },
  "customer": {
    "shippingAddress": {
      "address1": "181 Columbus Ave.",
      "city": "New York",
      "countryCode": "US",
      "name": "Rothy's 181 Columbus",
      "postalCode": "10023",
      "provinceCode": "NY"
    }
  },
  "lineItems": [
    {
      "additionalFields": {
        "sap_unit_of_measure": "PR"
      },
      "id": "000011",
      "quantity": 100,
      "sku": "002_110_BLK_5"
    },
    {
      "additionalFields": {
        "sap_unit_of_measure": "PR"
      },
      "id": "000012",
      "quantity": 100,
      "sku": "002_110_BLK_6"
    }
  ]
}
```

| Field               | Description                                                                                                                                   |
| ------------------- | --------------------------------------------------------------------------------------------------------------------------------------------- |
| purchaseOrderNumber | The STO Number in SAP provided by Boomi when the STO was created. Can have duplicates.                                                        |
| warehouseOrderId    | A unique order number that is generated by ChannelApe and required to fulfill an STO with our API.                                            |
| channelOrderId      | A unique value provided by SAP when the STO was created. Cannot have duplicates.                                                              |
| purchasedAt         | A timestamp provided by SAP when the STO was created. Indicates when the order was purchased or released.                                     |
| shippingCompany     | Value is determined by ChannelApe's Order Management System, taken from the user defined `Carrier Code` for the best qualified Shipping Rule. |
| shippingCompany     | Value is determined by ChannelApe's Order Management System, taken from the user defined `Service Code` for the best qualified Shipping Rule. |
| locationId          | Set by ChannelApe, it is the ID of the location responsible for fulfilling the order from ChannelApe's Inventory Management System.           |
| warehouseCode       | Added by ChannelApe, it is an alias representing the fulfilling location for use in ChannelApe's Order Routing Rules.                         |
| warehouseCompany    | Set by ChannelApe, it is one of 3 custom fields configured in ChannelApe's Order Management System and included in the payload.               |
| warehouseName       | Set by ChannelApe, it is one of 3 custom fields configured in ChannelApe's Order Management System and included in the payload.               |
| warehouseId         | Set by ChannelApe, it is one of 3 custom fields configured in ChannelApe's Order Management System and included in the payload.               |
| warehouseZipcode    | Added by ChannelApe, it is the zip code ChannelApe used when calculating shipping zones.                                                      |
| status              | The state of the order within ChannelApe's Order Management System.                                                                           |

##### Additional Fields

| Field                     | Description                                                                                                                                             |
| ------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ShipByDate                | Provided by SAP, the order should ship by the specified date.                                                                                           |
| PARTN                     | Used by Boomi to reference SAP's internal ID for the ship from location.                                                                                |
| LIFNR                     | Used by Boomi to reference SAP's internal ID for the ship from sub-location (sellable vs unsellable).                                                   |
| note_attributes_ship_from | Set by Boomi when the STO was created, it is the ID of the location responsible for fulfilling the order from ChannelApe's Inventory Management System. |
| WERKS                     | Used by Boomi to reference SAP's internal ID for the ship to location.                                                                                  |
| LGORT                     | Used by Boomi to reference SAP's internal ID for the ship to sub-location (sellable vs unsellable).                                                     |
| note_attributes_ship_to   | Set by Boomi when the STO was created, it is the ID of the location destined to receive the goods from ChannelApe's Inventory Management System.        |

##### Shipping Address

The destination for the Stock Transfer Order provided by SAP.

| Field        | Description                                    |
| ------------ | ---------------------------------------------- |
| company      | Company name associated with the address       |
| name         | Full name associated with the address          |
| phone        | Phone number associated with the address       |
| firstName    | First name associated with the address         |
| lastName     | Last name associated with the address          |
| address1     | First line of the address                      |
| address2     | Second line of the address                     |
| city         | City of the address                            |
| province     | Subdivision or state of the address            |
| provinceCode | ISO 3166-2 subdivision code of the address     |
| countryCode  | ISO 3166-1 alpha-2 country code of the address |
| country      | Country of the address                         |
| postalCode   | Postal or ZIP code of the address              |

##### Line Items

The destination for the Stock Transfer Order provided by SAP.

| Field    | Description                      |
| -------- | -------------------------------- |
| id       | Line Item ID provided by SAP     |
| quantity | Quantity to ship provided by SAP |
| sku      | SKU to ship provided by SAP      |

##### Line Item Additional Fields

| Field         | Description                                       |
| ------------- | ------------------------------------------------- |
| UnitOfMeasure | Used by Boomi to reference SAP's Unit of Measure. |

### Ship Confirmation

This webhook is sent to the party who created the Stock Transfer or Purchase Order to confirm its shipment.

#### Example Payload

```json
{
  "id": "208924061",
  "shippedAt": "2023-04-01T15:35:00.000Z",
  "status": "SHIPPED",
  "purchaseOrderNumber": "4600000039",
  "warehouseOrderId": "4600000039",
  "channelOrderId": "STO4600000039",
  "purchasedAt": "2023-04-01T00:00:00.000Z",
  "locationId": "819",
  "shippingCompany": "FEDEX",
  "shippingMethod": "GROUND",
  "trackingNumber": "123456789012345",
  "additionalFields": {
    "deliver_by_date": "2023-04-08T00:00:00.000Z",
    "note_attributes_ship_from": "819",
    "note_attributes_ship_to": "969",
    "shipping_lines_title": "VENDOR",
    "sap_source_location": "1111",
    "sap_destination_location": "2222",
    "sap_source_storage_location": "1111",
    "sap_destination_storage_location": "2222",
    "note_attribute_retail_order": "true",
    "warehouse_order_id": "4600000039",
    "CartonNumber": "1",
    "TotalOrderCartons": "5",
    "LicensePlate": "0386149425",
    "Sscc": "00001922492001525086",
    "EstimatedArrivalDate": "2023-04-08T00:00:00.000Z"
  },
  "lineItems": [
    {
      "additionalFields": {
        "sap_unit_of_measure": "PR"
      },
      "id": "000011",
      "quantity": 100,
      "sku": "002_110_BLK_5"
    },
    {
      "additionalFields": {
        "sap_unit_of_measure": "PR"
      },
      "id": "000012",
      "quantity": 100,
      "sku": "002_110_BLK_6"
    }
  ]
}
```

### Advanced Ship Notice

This webhook is intended for the party that will receive the shipment when an Advanced Ship Notice is created.

#### Example Payload

```json
{
  "id": "208924061",
  "shippedAt": "2023-04-01T15:35:00.000Z",
  "status": "SHIPPED",
  "purchaseOrderNumber": "4600000039",
  "warehouseOrderId": "4600000039",
  "channelOrderId": "STO4600000039",
  "purchasedAt": "2023-04-01T00:00:00.000Z",
  "locationId": "819",
  "shippingCompany": "FEDEX",
  "shippingMethod": "GROUND",
  "trackingNumber": "123456789012345",
  "additionalFields": {
    "deliver_by_date": "2023-04-08T00:00:00.000Z",
    "note_attributes_ship_from": "819",
    "note_attributes_ship_to": "969",
    "shipping_lines_title": "VENDOR",
    "sap_source_location": "1111",
    "sap_destination_location": "2222",
    "sap_source_storage_location": "1111",
    "sap_destination_storage_location": "2222",
    "note_attribute_retail_order": "true",
    "warehouse_order_id": "4600000039",
    "CartonNumber": "1",
    "TotalOrderCartons": "5",
    "LicensePlate": "0386149425",
    "Sscc": "00001922492001525086",
    "EstimatedArrivalDate": "2023-04-08T00:00:00.000Z"
  },
  "lineItems": [
    {
      "additionalFields": {
        "sap_unit_of_measure": "PR"
      },
      "id": "000011",
      "quantity": 100,
      "sku": "002_110_BLK_5"
    },
    {
      "additionalFields": {
        "sap_unit_of_measure": "PR"
      },
      "id": "000012",
      "quantity": 100,
      "sku": "002_110_BLK_6"
    }
  ]
}
```

#### Timing

It is sent upon creation of an Advanced Ship Notice.

### Receipt Confirmation

This webhook is intended for the party that created the Advanced Ship Notice to both confirm and describe the goods received.

#### Timing

It is sent upon the creation of a Receipt Confirmation.

Multiple partial receipts will result in multiple Receipt Confirmations.

#### Order Level

| Name                | Type                    | Description                                                              |
| ------------------- | ----------------------- | ------------------------------------------------------------------------ |
| additionalFields    | dict of AdditionalField | Additional fields are normalized into an object with the name as the key |
| customer            | Customer                | Object containing customer information                                   |
| lineItems           | array of LineItem       | Line Items on the order                                                  |
| locationId          | string                  | ChannelApe Location ID of the location associated with the request       |
| purchasedAt         | Date                    | Date and time the order was purchased                                    |
| purchaseOrderNumber | string                  | Unique identifier for the purchase order                                 |
| shippingCompany     | string                  | Name of the shipping company used for the order                          |
| shippingMethod      | string                  | Shipping method used for the order                                       |
| status              | string                  | Current status of the order                                              |
| warehouseOrderId    | string                  | Unique identifier for the warehouse order                                |
| warehouseId         | string                  | ID of the warehouse associated with the order                            |
| warehouseCode       | string                  | Code for the warehouse associated with the order                         |
| warehouseName       | string                  | Name of the warehouse associated with the order                          |
| warehouseCompany    | string                  | Company associated with the warehouse for the order                      |
| warehouseZipcode    | string                  | Zipcode of the warehouse associated with the order                       |

#### Order Level Additional Fields

| Name                      | Source | When         | Value                              | Usage                                                                     |
| ------------------------- | ------ | ------------ | ---------------------------------- | ------------------------------------------------------------------------- |
| note_attributes_ship_to   | S4     | STO Creation | A ChannelApe Location ID           | Tells ChannelApe which inventory location will ship the goods.            |
| WERKS                     | S4     | STO Creation | SAPs's Store / DC Destination      | Mapped for Boomi's convenience.                                           |
| LGORT                     | S4     | STO Creation | SAP's Destination Storage Location | Mapped for Boomi's convenience.                                           |
| note_attributes_ship_from | S4     | STO Creation | A ChannelApe Location ID           | Tells ChannelApe which inventory location will receive the shipped goods. |
| LIFNR                     | S4     | STO Creation | Supplier Number                    | Mapped for Boomi's convenience.                                           |
| Sscc                      | NRI    | STO Shipment | GS1-128 Number                     | Will be barcoded and printed on carton labels from manfucaturer           |
| ShipmentNumber            | NRI    | STO Shipment | Number                             | Used to uniquely identify a shipment from NRI.                            |
| LicensePlate              | NRI    | STO Shipment | Alphanumeric with hyphens          | Currently barcoded and printed on retail carton labels.                   |
| CartonNumber              | NRI    | STO Shipment | Incremental integer                | The carton number in a multi-carton shipment. e.g. 1, 2, 3, 4...          |

#### Customer

| Name             | Type                     | Description                                               |
| ---------------- | ------------------------ | --------------------------------------------------------- |
| additionalFields | array of AdditionalField | An array of additional fields for the customer if present |
| name             | string                   | Name of the customer                                      |
| firstName        | string                   | First name of the customer                                |
| lastName         | string                   | Last name of the customer                                 |
| email            | string                   | Email address of the customer                             |
| phone            | string                   | Phone number of the customer                              |
| billingAddress   | Address                  | Billing address of the customer                           |
| shippingAddress  | Address                  | Shipping address of the customer                          |

#### Address

| Name             | Type                     | Description                                    |
| ---------------- | ------------------------ | ---------------------------------------------- |
| company          | string                   | Company name associated with the address       |
| name             | string                   | Full name associated with the address          |
| phone            | string                   | Phone number associated with the address       |
| firstName        | string                   | First name associated with the address         |
| lastName         | string                   | Last name associated with the address          |
| address1         | string                   | First line of the address                      |
| address2         | string                   | Second line of the address                     |
| city             | string                   | City of the address                            |
| province         | string                   | Subdivision or state of the address            |
| provinceCode     | string                   | ISO 3166-2 subdivision code of the address     |
| countryCode      | string                   | ISO 3166-1 alpha-2 country code of the address |
| country          | string                   | Country of the address                         |
| postalCode       | string                   | Postal or ZIP code of the address              |
| additionalFields | array of AdditionalField | Additional fields for the address              |

#### LineItem

| Name             | Type                    | Description                                                               |
| ---------------- | ----------------------- | ------------------------------------------------------------------------- |
| id               | string                  | A unique identifier for the lineItem                                      |
| sku              | string                  | The SKU of the item.                                                      |
| upc              | string                  | The UPC (universal product code) of the item.                             |
| title            | string                  | The title of the item.                                                    |
| quantity         | number                  | The number of units of the item being purchased.                          |
| reserveQuantity  | number                  | The number of units of the item reserved for future orders.               |
| presaleQuantity  | number                  | The number of units of the item that are being sold as part of a presale. |
| vendor           | string                  | The vendor or manufacturer of the item.                                   |
| grams            | number                  | The weight of the item in grams.                                          |
| shippingMethod   | string                  | The method of shipping for the line item.                                 |
| restockType      | string                  | If this was a return                                                      |
| giftCardCode     | string                  | The code for any gift card applied to the line item.                      |
| giftCardId       | string                  | The unique identifier for any gift card applied to the line item.         |
| price            | number                  | The price of a single unit of the item.                                   |
| shippingPrice    | number                  | The price of shipping for the line item.                                  |
| shippingTax      | number                  | The tax on shipping for the line item.                                    |
| taxes            | array of Tax            | Any applicable taxes for the line item.                                   |
| additionalFields | dict of AdditionalField | Additional fields are normalized into an object with the name as the key  |

#### Item Level Additional Fields

| Name                                    | Source     | Usage                                                                                                    |
| --------------------------------------- | ---------- | -------------------------------------------------------------------------------------------------------- |
| DeliveryQuantityTypeCode                | SAP ByD    | Provided by SAP ByD. Only mapped so that ChannelApe can send asynchronous communucation back to SAP ByD. |
| HTSCode                                 | SAP ByD    | Provided by SAP ByD. Only mapped so that ChannelApe can send asynchronous communucation back to SAP ByD. |
| CountryOfOrigin                         | SAP ByD    | Provided by SAP ByD. Only mapped so that ChannelApe can send asynchronous communucation back to SAP ByD. |
| StockTransferOrderReferenceID           | SAP ByD    | Provided by SAP ByD. Only mapped so that ChannelApe can send asynchronous communucation back to SAP ByD. |
| StockTransferOrderReferenceTypeCode     | SAP ByD    | Provided by SAP ByD. Only mapped so that ChannelApe can send asynchronous communucation back to SAP ByD. |
| StockTransferOrderReferenceItemID       | SAP ByD    | Provided by SAP ByD. Only mapped so that ChannelApe can send asynchronous communucation back to SAP ByD. |
| StockTransferOrderReferenceItemTypeCode | SAP ByD    | Provided by SAP ByD. Only mapped so that ChannelApe can send asynchronous communucation back to SAP ByD. |
| fulfillable_quantity                    | ChannelApe | Legacy field. Not used.                                                                                  |
| Z_PurchaseOrder_ODR                     | SAP ByD    | Provided by SAP ByD. Only mapped so that ChannelApe can send asynchronous communucation back to SAP ByD. |
| OutboundDeliveryExecution.ID            | SAP ByD    | Provided by SAP ByD. Only mapped so that ChannelApe can send asynchronous communucation back to SAP ByD. |
| Item.ID                                 | SAP ByD    | Provided by SAP ByD. Only mapped so that ChannelApe can send asynchronous communucation back to SAP ByD. |

### Example Payload

```json
{
  "id": "208924061",
  "shippedAt": "2023-04-01T15:35:00.000Z",
  "status": "RECEIVED",
  "purchaseOrderNumber": "4600000039",
  "warehouseOrderId": "4600000039",
  "channelOrderId": "STO4600000039",
  "purchasedAt": "2023-04-01T00:00:00.000Z",
  "locationId": "819",
  "shippingCompany": "FEDEX",
  "shippingMethod": "GROUND",
  "trackingNumber": "123456789012345",
  "additionalFields": {
    "deliver_by_date": "2023-04-08T00:00:00.000Z",
    "note_attributes_ship_from": "819",
    "note_attributes_ship_to": "969",
    "shipping_lines_title": "VENDOR",
    "sap_source_location": "1111",
    "sap_destination_location": "2222",
    "sap_source_storage_location": "1111",
    "sap_destination_storage_location": "2222",
    "note_attribute_retail_order": "true",
    "warehouse_order_id": "4600000039",
    "CartonNumber": "1",
    "TotalOrderCartons": "5",
    "LicensePlate": "0386149425",
    "Sscc": "00001922492001525086",
    "EstimatedArrivalDate": "2023-04-08T00:00:00.000Z",
    "sap_purchase_order_number": "4600000039",
    "sap_asn_number": "0180000011",
    "sap_handling_unit_number": "4600000039001",
    "country_of_origin": "HK",
    "receipt_id": "27d7b5b5-5451-470e-98cd-374100ba8dc4",
    "actual_arrival_date": "2023-04-25T19:09:11.127",
    "actual_received_date": "2023-04-25T19:18:10.143"
  },
  "lineItems": [
    {
      "additionalFields": {
        "sap_unit_of_measure": "PR",
        "sap_asn_line_number": "000010",
        "damaged_qty": "0",
        "variance": "0",
        "received_qty": "100"
      },
      "id": "000011",
      "quantity": 100,
      "sku": "002_110_BLK_5"
    },
    {
      "additionalFields": {
        "sap_unit_of_measure": "PR",
        "sap_asn_line_number": "00020",
        "damaged_qty": "0",
        "variance": "0",
        "received_qty": "100"
      },
      "id": "000012",
      "quantity": 100,
      "sku": "002_110_BLK_6"
    }
  ]
}
```
